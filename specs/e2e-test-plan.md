# E2E 테스트 계획

## 개요
동행복권 로또6/45 자동화 시스템의 E2E 테스트 계획입니다.

## 테스트 파일 구조

```
tests/
├── seed.spec.ts        # 템플릿
├── login.spec.ts       # 로그인 테스트
├── purchase.spec.ts    # 구매 플로우 테스트
└── check.spec.ts       # 조회 기능 테스트
```

---

## 1. 로그인 테스트 (login.spec.ts)

### 1.1 로그인 페이지 로드
**시드:** `tests/seed.spec.ts`

**단계:**
1. https://www.dhlottery.co.kr/login 접속
2. 아이디 입력 필드(role: textbox, name: "아이디") 확인
3. 비밀번호 입력 필드(role: textbox, name: "비밀번호") 확인

**기대 결과:**
- 두 입력 필드가 모두 표시됨

### 1.2 유효한 자격 증명으로 로그인 성공
**시드:** `tests/seed.spec.ts`

**단계:**
1. 로그인 페이지 접속
2. 환경 변수에서 아이디/비밀번호 입력
3. Enter 키로 제출

**기대 결과:**
- 로그아웃 버튼 표시 또는 URL이 로그인 페이지가 아님

### 1.3 잘못된 비밀번호로 로그인 실패
**시드:** `tests/seed.spec.ts`

**단계:**
1. 로그인 페이지 접속
2. 유효한 아이디 + 잘못된 비밀번호 입력
3. Enter 키로 제출

**기대 결과:**
- 에러 메시지 표시 또는 로그인 페이지 유지

### 1.4 빈 자격 증명으로 로그인 실패
**시드:** `tests/seed.spec.ts`

**단계:**
1. 로그인 페이지 접속
2. 아무것도 입력하지 않고 Enter 키 제출

**기대 결과:**
- 에러 메시지 표시 또는 로그인 페이지 유지

---

## 2. 구매 플로우 테스트 (purchase.spec.ts)

> **구현 방식**: ol.dhlottery.co.kr 직접 접근 (iframe 없음)

### 2.1 구매 페이지 직접 접근
**시드:** `tests/seed.spec.ts`

**전제 조건:** 로그인 완료

**단계:**
1. https://ol.dhlottery.co.kr/olotto/game/game645.do 직접 이동
2. 알림 팝업 닫기 (있으면)

**기대 결과:**
- URL에 ol.dhlottery.co.kr 포함

### 2.2 자동번호발급 링크 표시
**시드:** `tests/seed.spec.ts`

**전제 조건:** 로그인 완료, 구매 페이지 접근

**단계:**
1. 구매 페이지에서 자동번호발급 링크 확인

**기대 결과:**
- "자동번호발급" 링크가 표시됨

### 2.3 자동번호발급 클릭 후 확인 버튼
**시드:** `tests/seed.spec.ts`

**전제 조건:** 로그인 완료, 구매 페이지 접근

**단계:**
1. 자동번호발급 링크 클릭
2. 확인 버튼 표시 확인

**기대 결과:**
- 확인 버튼이 표시됨

### 2.4 DRY RUN: 구매 직전까지 진행
**시드:** `tests/seed.spec.ts`

**전제 조건:** 로그인 완료

**단계:**
1. 구매 페이지로 직접 이동
2. 알림 팝업 닫기 (있으면)
3. 자동번호발급 클릭
4. 확인 버튼 클릭 (슬롯 추가)
5. 구매하기 버튼 표시 확인 (클릭 안함)
6. 스크린샷 저장

**기대 결과:**
- 구매하기 버튼이 표시됨
- 실제 구매는 진행되지 않음

---

## 3. 조회 기능 테스트 (check.spec.ts)

### 3.1 당첨번호 조회 (로그인 불필요)

#### 3.1.1 로또 6/45 슬라이더 표시
**시드:** `tests/seed.spec.ts`

**단계:**
1. 메인 페이지 접속
2. .swiper.lt645 요소 확인

**기대 결과:**
- 슬라이더가 표시됨

#### 3.1.2 당첨 번호 표시
**시드:** `tests/seed.spec.ts`

**단계:**
1. 메인 페이지 접속
2. .lt645-list .lt-ball 요소 카운트

**기대 결과:**
- 최소 7개 요소 (당첨번호 6개 + 보너스 1개)

#### 3.1.3 회차 정보 추출
**시드:** `tests/seed.spec.ts`

**단계:**
1. 메인 페이지 접속
2. .lt645-round 텍스트 추출

**기대 결과:**
- "XXXX회" 형식의 텍스트

#### 3.1.4 번호 범위 검증
**시드:** `tests/seed.spec.ts`

**단계:**
1. 메인 페이지 접속
2. 모든 번호 추출 및 검증

**기대 결과:**
- 모든 번호가 1~45 범위 내

### 3.2 구매내역 조회 (로그인 필요)

#### 3.2.1 구매내역 페이지 이동
**시드:** `tests/seed.spec.ts`

**전제 조건:** 로그인 완료

**단계:**
1. /mypage/mylotteryledger 접속

**기대 결과:**
- URL에 mylotteryledger 포함

#### 3.2.2 상세 검색 펼치기
**시드:** `tests/seed.spec.ts`

**전제 조건:** 로그인 완료

**단계:**
1. 구매내역 페이지 접속
2. "상세 검색 펼치기" 버튼 확인

**기대 결과:**
- 버튼이 표시됨

#### 3.2.3 기간 선택 버튼
**시드:** `tests/seed.spec.ts`

**전제 조건:** 로그인 완료

**단계:**
1. 구매내역 페이지 접속
2. 상세 검색 펼치기 클릭
3. "최근 1주일" 버튼 확인

**기대 결과:**
- 버튼이 표시됨

#### 3.2.4 로또6/45 필터 선택
**시드:** `tests/seed.spec.ts`

**전제 조건:** 로그인 완료

**단계:**
1. 구매내역 페이지 접속
2. 상세 검색 펼치기
3. 최근 1주일 선택
4. #ltGdsSelect에서 LO40 선택

**기대 결과:**
- 선택 값이 LO40

#### 3.2.5 검색 결과 로드
**시드:** `tests/seed.spec.ts`

**전제 조건:** 로그인 완료

**단계:**
1. 필터 설정 후 검색 버튼 클릭
2. 결과 대기

**기대 결과:**
- 결과 행이 나타나거나 "조회 결과가 없습니다" 메시지

#### 3.2.6 바코드 표시
**시드:** `tests/seed.spec.ts`

**전제 조건:** 로그인 완료, 구매 내역 있음

**단계:**
1. 필터 설정 후 검색
2. span.whl-txt.barcd 요소 확인

**기대 결과:**
- 바코드가 표시됨 (구매 내역이 있는 경우)

#### 3.2.7 티켓 상세 모달
**시드:** `tests/seed.spec.ts`

**전제 조건:** 로그인 완료, 구매 내역 있음

**단계:**
1. 필터 설정 후 검색
2. 바코드 클릭
3. #Lotto645TicketP 모달 확인
4. .ticket-num-box 요소 확인
5. 모달 닫기

**기대 결과:**
- 티켓 상세 모달이 열림
- 티켓 번호 박스가 표시됨
- 모달 정상 닫힘

---

## 실행 방법

```bash
# 전체 E2E 테스트 (헤드리스)
npm run test:e2e

# 브라우저 표시하며 테스트
npm run test:e2e:headed

# Playwright UI 모드
npm run test:e2e:ui

# 특정 테스트만 실행
npx playwright test tests/login.spec.ts
npx playwright test tests/check.spec.ts --grep "당첨번호"
```

## 환경 변수

```env
LOTTO_USERNAME=아이디
LOTTO_PASSWORD=비밀번호
HEADED=true  # 브라우저 표시
```
